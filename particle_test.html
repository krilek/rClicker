<html>
	<head>
		<meta charset="UTF-8" />
		<link rel="stylesheet" type="text/css" href="./css/flaticon.css"> 
		<style>
			::before
			{
				font-size: 100px !important;
			}
			.element
			{
				font-size: 100px;
				transition: 2s;
				transition-timing-function: cubic-bezier(0.83, 0.68, 0.17, 0.32); /* Zmienić na ; LUB NIE XD*/
			}
			body
			{
				overflow: hidden;
			}
			#stoned
			{
				z-index: -1;
				position: absolute;
				/*
				left: 0px;
				right: 0px;
				bottom: 0px;
				top: 0px;
				*/
				
				left: -200px;
				top: -200px;
				right: -200px;
				bottom: -200px;
				
				overflow: hidden;
			}
		</style>
	</head>
	<body id="body">
		<button onclick="stoned('weed', 7000000);"> Stworz </button>
		<div id="stoned"></div>
		<script type="text/javascript"> 
		var arrayOfFlies = [];
		var currentlyStoned = false;
		var rainbowOn = false;
		var particlesOn = false;

		function textGenerator(length){
			var signArray = "ABCDEFGHIJKLMNOPRSTUVWXYZ"
			var ret = "";
			while(ret.length != length)
 				{var rand = Math.floor(Math.random() * 25);
 				 				ret += signArray.charAt(rand);}
 				 				return ret;

		}


		function colorGenerator() {
		    var signArray = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'a', 'b', 'c', 'd', 'e', 'f'];
		    var output = "#";
		    while (output.length != 7) {
		        var rand = Math.floor(Math.random() * 16);
		        output += signArray[rand];
		    }
		    return output;
		}

		function ID(which) {
		    return document.getElementById(which)
		}

		function stoned(byWhat, duration) {
		    if (currentlyStoned)
		        return -1;
		    else {
		        currentlyStoned = true;


		        if (!rainbowOn)
		            rainbow(duration);

		        function rainbow(duration) {
		            rainbowOn = true;
		            ID("body").style.backgroundImage = "radial-gradient(farthest-corner at 50% 50%," + colorGenerator() + ", " + colorGenerator() + ", " + colorGenerator() + ", " + colorGenerator() + ")";
		            if (duration == 0 || duration <= 0) {
		                ID("body").style.backgroundImage = "none";
		                rainbowOn = false;
		                console.log("finished!" + duration);
		                return true;
		            }
		            setTimeout(function() {
		                rainbow(duration - 100);
		            }, 100);
		        }
		        //console.log("finisheddasdas!"+duration);
		        if (!particlesOn && rainbowOn)
		            generateParticles(duration);

		        function generateParticles() {
		            particlesOn = true;
					
		                //ID("stoned").removeChild(ID("stoned").firstChild);
		            if (rainbowOn) {
		            	createIMG("weed")
		            	setTimeout(function(){
		            		arrayOfFlies.forEach(remove);},2000);
		                setTimeout(generateParticles, 100);
		            } else {
		                particlesOn = false;
		                //setTimeout(function (){ID("stoned").innerHTML = "";}, 2000)
		                return false;
		            }
		        }
		        currentlyStoned = false;
		    }

		}

		function createIMG(image, startX, startY, endX, endY) {
			var identifier = textGenerator(3);
		    var box = ID("stoned")
		    if (startX == null || startY == null || endX == null || endY == null)
		        randomPos();
		    var span = document.createElement("span");
		    span.id = identifier;
		    span.className = "flaticon-antibiotic element";
		    span.style.position = "absolute";
		    span.style.left = startX + "px";
		    span.style.top = startY + "px";
		    ID("stoned").appendChild(span);
		    setTimeout(move, 1);

		    function randomPos() //Flying particles around screen at random pos
		    {
		        var divWidth = box.clientWidth;
		        var divHeight = box.clientHeight;
		        //choose which to generate first: below 10 start generating x first, above 10 y first
		        var mode = Math.floor(Math.random() * 20);
		        if (mode < 10) {
		            startX = Math.floor(Math.random() * divWidth);
		            if (startX <= 50 || startX >= divWidth - 50) {
		                startY = Math.floor(Math.random() * divHeight);
		            } else if (startX >= 50 && startX <= divWidth - 50) {
		                do {
		                    startY = Math.floor(Math.random() * divHeight);
		                } while (startY >= 50 && startY <= divHeight - 50);
		            }
		        } else {
		            startY = Math.floor(Math.random() * divHeight);

		            if (startY <= 50 || startY >= divHeight - 50) {
		                startX = Math.floor(Math.random() * divWidth);
		            } else if (startY >= 50 && startY <= divHeight - 50) {
		                do {
		                    startX = Math.floor(Math.random() * divWidth);
		                } while (startX >= 50 && startX <= divWidth - 50);
		            }
		        }
		        endX = divWidth - startX;
		        endY = divHeight - startY;
		        //console.log("randomized point "+randStartX+", "+randStartY+ " end "+randEndX+", "+randEndY+ " div dimension "+divWidth+", "+divHeight);
		    }

		    function move() {
		        span.style.left = endX + "px";
		        span.style.top = endY + "px";
		        span.addEventListener("transitionend", destroy);
		        function destroy() {
		            span.removeEventListener("transitionend", destroy);
		            arrayOfFlies.push(identifier);
		            console.log("Chyba Usunięto");
		            
		        }
		    }
		    console.log("zakończono");
		}
		
		function remove(name)
		{
			ID("stoned").removeChild(document.getElementById("name"));
		}

		</script>
	</body>
</html>
