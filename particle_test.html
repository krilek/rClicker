<html>
	<head>
		<meta charset="UTF-8" />
		<link rel="stylesheet" type="text/css" href="./css/flaticon.css"> 
		<style>
			::before
			{
				font-size: 100px !important;
			}
			.element
			{
				font-size: 100px;
				transition: 2s;
				transition-timing-function: cubic-bezier(0.83, 0.68, 0.17, 0.32); /* ZmieniÄ‡ na ; LUB NIE XD*/
			}
			body
			{
				overflow: hidden;
			}
			#stoned
			{
				z-index: -1;
				position: absolute;
				/*
				left: 0px;
				right: 0px;
				bottom: 0px;
				top: 0px;
				*/
				
				left: -200px;
				top: -200px;
				right: -200px;
				bottom: -200px;
				
				overflow: hidden;
			}
		</style>
	</head>
	<body id="body">
		<button onclick="stoned('weed', 7000000);"> Stworz </button>
		<div id="stoned"></div>
		<script type="text/javascript"> 
		var arrayOfFlies = [];
		var currentlyStoned = false;
		var rainbowOn = false;
		var particlesOn = false;

		Number.prototype.round = function(miejsc){
			return +(Math.round(this + "e+" + miejsc) + "e-" + miejsc);
		}

	
	    function moveObject(duration){
	    	var box = document.getElementById("body");
	    	var startX, startY, endX, endY;
	    	randomPos(50);
	    	function randomPos(margin) //Flying particles around screen at random pos
	        {
	           
	            var divWidth = box.clientWidth;
	            var divHeight = box.clientHeight;
	            //choose which to generate first: below 10 start generating x first, above 10 y first
	            var mode = Math.floor(Math.random() * 20);
	            if (mode < 10) {
	                startX = Math.floor(Math.random() * divWidth);
	                if (startX <= margin || startX >= divWidth - margin) {
	                    startY = Math.floor(Math.random() * divHeight);
	                } else if (startX >= margin && startX <= divWidth - margin) {
	                    do {
	                        startY = Math.floor(Math.random() * divHeight);
	                    } while (startY >= margin && startY <= divHeight - margin);
	                }
	            } else {
	                startY = Math.floor(Math.random() * divHeight);

	                if (startY <= margin || startY >= divHeight - margin) {
	                    startX = Math.floor(Math.random() * divWidth);
	                } else if (startY >= margin && startY <= divHeight - margin) {
	                    do {
	                        startX = Math.floor(Math.random() * divWidth);
	                    } while (startX >= margin && startX <= divWidth - margin);
	                }
	            }
	            endX = divWidth - startX;
	            endY = divHeight - startY;
	            console.log("randomized point "+startX+", "+startY+ " end "+endX+", "+endY+ " div dimension "+divWidth+", "+divHeight);
	        }
	    	var left = startX;
	    	var top = startY;
	    	var amountOfSteps = duration/10;
	    	var distanceX = Math.abs(endX - left);
	    	var distanceY = Math.abs(endY - top);
	    	var stepX = (distanceX/amountOfSteps);
	    	var stepY = (distanceY/amountOfSteps);
	    	function frame()
	    	{
	    		if(left <= endX)
	    			left += stepX;
	    		else
	    			left -= stepX;
	    		if(top <= endY)
	    			top += stepY;
	    		else
	    			top -= stepY;

	    		distanceX -= stepX;
	    		distanceY -= stepY;
	    		document.getElementById("box").style.left = left+"px";
	    		document.getElementById("box").style.top = top+"px";
	    		if(distanceX <= 0 && distanceY <= 0)
	    		{
	    			clearInterval(timer);
	    			moveObject(2000);
	    		}
	    	}
	    	var timer = setInterval(frame, 10);
	    	console.log(amountOfSteps + " "+ distanceX+" "+distanceY+" "+stepX+" "+stepY);
	    }	


		function colorGenerator() {
		    var signArray = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'a', 'b', 'c', 'd', 'e', 'f'];
		    var output = "#";
		    while (output.length != 7) {
		        var rand = Math.floor(Math.random() * 16);
		        output += signArray[rand];
		    }
		    return output;
		}

		function ID(which) {
		    return document.getElementById(which)
		}

		function stoned(byWhat, duration) {
		    if (currentlyStoned)
		        return -1;
		    else {
		        currentlyStoned = true;


		        if (!rainbowOn)
		            rainbow(duration);

		        function rainbow(duration) {
		            rainbowOn = true;
		            ID("body").style.backgroundImage = "radial-gradient(farthest-corner at 50% 50%," + colorGenerator() + ", " + colorGenerator() + ", " + colorGenerator() + ", " + colorGenerator() + ")";
		            if (duration == 0 || duration <= 0) {
		                ID("body").style.backgroundImage = "none";
		                rainbowOn = false;
		                console.log("finished!" + duration);
		                return true;
		            }
		            setTimeout(function() {
		                rainbow(duration - 100);
		            }, 100);
		        }
		        //console.log("finisheddasdas!"+duration);
		        if (!particlesOn && rainbowOn)
		            generateParticles(duration);

		        function generateParticles() {
		            particlesOn = true;
					
		                //ID("stoned").removeChild(ID("stoned").firstChild);
		            if (rainbowOn) {
		            	createIMG("weed")
		            	setTimeout(function(){
		            		arrayOfFlies.forEach(remove);},2000);
		                setTimeout(generateParticles, 100);
		            } else {
		                particlesOn = false;
		                //setTimeout(function (){ID("stoned").innerHTML = "";}, 2000)
		                return false;
		            }
		        }
		        currentlyStoned = false;
		    }

		}

		</script>
	</body>
</html>
